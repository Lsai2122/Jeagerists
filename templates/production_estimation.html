{% extends "base.html" %}

{% block title %}Production Estimation - KrishiKavach{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title text-center mb-4">
                        <i class="fas fa-chart-line me-2"></i>Production Estimation
                    </h2>
                    <p class="text-center mb-5">
                        Estimate your crop production based on field conditions and inputs.
                    </p>
                    <form id="productionForm">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-ruler-combined"></i></span>
                                    <input type="number" class="form-control" id="area_ha" name="area_ha" placeholder="Field Area (Hectares)" step="0.1" min="0.1" required>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-seedling"></i></span>
                                    <input type="number" class="form-control" id="n_req_kg_per_ha" name="n_req_kg_per_ha" placeholder="Nitrogen Requirement (kg/ha)" step="0.1" min="0" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-leaf"></i></span>
                                    <input type="number" class="form-control" id="p_req_kg_per_ha" name="p_req_kg_per_ha" placeholder="Phosphorus Requirement (kg/ha)" step="0.1" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-spa"></i></span>
                                    <input type="number" class="form-control" id="k_req_kg_per_ha" name="k_req_kg_per_ha" placeholder="Potassium Requirement (kg/ha)" step="0.1" min="0" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-thermometer-half"></i></span>
                                    <input type="number" class="form-control" id="temperature_c" name="temperature_c" placeholder="Temperature (Â°C)" step="0.1" required>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-tint"></i></span>
                                    <input type="number" class="form-control" id="humidity_percent" name="humidity_percent" placeholder="Humidity (%)" step="0.1" min="0" max="100" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-flask"></i></span>
                                    <input type="number" class="form-control" id="ph" name="ph" placeholder="pH Level (0-14)" step="0.1" min="0" max="14" required>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-cloud-showers-heavy"></i></span>
                                    <input type="number" class="form-control" id="rainfall_mm" name="rainfall_mm" placeholder="Rainfall (mm)" step="0.1" min="0" required>
                                </div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-calculator me-2"></i>Estimate Production
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4" id="results" style="display: none;">
        <div class="col-lg-10 mx-auto">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title text-center mb-4">
                        <i class="fas fa-chart-bar me-2"></i>Production Estimation Results
                    </h3>
                    <div class="row text-center">
                        <div class="col-md-6 border-end">
                            <h5>Predicted Yield per Hectare</h5>
                            <h2 id="yieldPerHectare" class="display-4"></h2>
                            <p>kg per hectare</p>
                        </div>
                        <div class="col-md-6">
                            <h5>Total Predicted Production</h5>
                            <h2 id="totalProduction" class="display-4"></h2>
                            <p>kg total</p>
                        </div>
                    </div>
                    <hr class="my-4">
                    <div class="alert mt-4">
                        <h5><i class="fas fa-lightbulb me-2"></i>Optimization Tips</h5>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check-circle me-2"></i>Consider adjusting fertilizer ratios based on soil test results.</li>
                            <li><i class="fas fa-check-circle me-2"></i>Monitor weather conditions for optimal planting timing.</li>
                            <li><i class="fas fa-check-circle me-2"></i>Implement proper irrigation scheduling.</li>
                            <li><i class="fas fa-check-circle me-2"></i>Regular field monitoring for pest and disease management.</li>
                        </ul>
                    </div>
                    <div class="row mt-4 text-center">
                        <div class="col-md-4">
                            <div class="card p-3">
                                <h6>Good Conditions</h6>
                                <p class="mb-0">Yield may increase by 10-15%</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card p-3">
                                <h6>Average Conditions</h6>
                                <p class="mb-0">Yield as predicted</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card p-3">
                                <h6>Poor Conditions</h6>
                                <p class="mb-0">Yield may decrease by 10-20%</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script>
    document.getElementById('productionForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        showLoading();
        
        const formData = {
            area_ha: document.getElementById('area_ha').value,
            n_req_kg_per_ha: document.getElementById('n_req_kg_per_ha').value,
            p_req_kg_per_ha: document.getElementById('p_req_kg_per_ha').value,
            k_req_kg_per_ha: document.getElementById('k_req_kg_per_ha').value,
            temperature_c: document.getElementById('temperature_c').value,
            humidity_percent: document.getElementById('humidity_percent').value,
            ph: document.getElementById('ph').value,
            rainfall_mm: document.getElementById('rainfall_mm').value
        };
        
        try {
            const response = await fetch('/predict_production', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            const result = await response.json();
            
            if (result.error) {
                showAlert(result.error, 'danger');
            } else {
                // Display results
                document.getElementById('yieldPerHectare').textContent = result.predicted_yield_per_hectare.toLocaleString();
                document.getElementById('totalProduction').textContent = result.total_predicted_production.toLocaleString();
                
                document.getElementById('results').style.display = 'block';
                showAlert('Production estimation completed successfully!', 'success');
            }
        } catch (error) {
            showAlert('Error estimating production. Please try again.', 'danger');
        }
        
        hideLoading();
    });
</script>
{% endblock %}